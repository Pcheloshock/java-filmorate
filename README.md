# java-filmorate
Template repository for Filmorate project.

-- src/main/resources/schema.sql

-- Удаление существующих таблиц
DROP TABLE IF EXISTS film_genres;
DROP TABLE IF EXISTS film_likes;
DROP TABLE IF EXISTS friendships;
DROP TABLE IF EXISTS films;
DROP TABLE IF EXISTS users;
DROP TABLE IF EXISTS genres;
DROP TABLE IF EXISTS mpa_ratings;

-- Создание таблицы рейтингов MPA
CREATE TABLE IF NOT EXISTS mpa_ratings (
id INTEGER PRIMARY KEY,
name VARCHAR(50) NOT NULL,
description VARCHAR(255)
);

-- Создание таблицы жанров
CREATE TABLE IF NOT EXISTS genres (
id INTEGER PRIMARY KEY,
name VARCHAR(50) NOT NULL
);

-- Создание таблицы пользователей
CREATE TABLE IF NOT EXISTS users (
id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
email VARCHAR(255) NOT NULL,
login VARCHAR(50) NOT NULL,
name VARCHAR(100),
birthday DATE,
CONSTRAINT unique_email UNIQUE (email)
);

-- Создание таблицы фильмов
CREATE TABLE IF NOT EXISTS films (
id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
name VARCHAR(255) NOT NULL,
description VARCHAR(200),
release_date DATE NOT NULL,
duration INTEGER NOT NULL,
mpa_rating_id INTEGER REFERENCES mpa_ratings(id) ON DELETE RESTRICT
);

-- Создание таблицы связи фильмов и жанров (многие ко многим)
CREATE TABLE IF NOT EXISTS film_genres (
film_id INTEGER REFERENCES films(id) ON DELETE CASCADE,
genre_id INTEGER REFERENCES genres(id) ON DELETE CASCADE,
PRIMARY KEY (film_id, genre_id)
);

-- Создание таблицы лайков фильмов
CREATE TABLE IF NOT EXISTS film_likes (
film_id INTEGER REFERENCES films(id) ON DELETE CASCADE,
user_id INTEGER REFERENCES users(id) ON DELETE CASCADE,
PRIMARY KEY (film_id, user_id)
);

-- Создание таблицы дружбы
CREATE TABLE IF NOT EXISTS friendships (
user_id INTEGER REFERENCES users(id) ON DELETE CASCADE,
friend_id INTEGER REFERENCES users(id) ON DELETE CASCADE,
status VARCHAR(20) DEFAULT 'UNCONFIRMED',
PRIMARY KEY (user_id, friend_id)
);

┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│   users     │     │   films     │     │ mpa_ratings │
├─────────────┤     ├─────────────┤     ├─────────────┤
│ user_id (PK)│◄────┤ mpa_id (FK) │────►│ mpa_id (PK) │
│ email       │     │ film_id (PK)│     │ name        │
│ login       │     │ name        │     │ description │
│ name        │     │ description │     └─────────────┘
│ birthday    │     │ release_date│
└─────────────┘     │ duration    │     ┌─────────────┐
│                   └─────────────┘     │  genres     │
│                     │                 ├─────────────┤
│                     │                 │ genre_id(PK)│
│          ┌───────-───────┐            │ name        │
│          │       │       │            └─────────────┘
│          ▼       ▼       ▼              │
│    ┌─────────────┐      ┌─────────────┐ │
└──► │   likes     │      │film_genres  │◄┘
     ├─────────────┤      ├─────────────┤
     │ film_id(FK) │      │ film_id(FK) │
     │ user_id (FK)│      │ genre_id(FK)│
     └─────────────┘      └─────────────┘
        │
┌─────────────┐
│friendships  |
├─────────────┤
│ user_id (FK)│
│ friend_id(FK)│
│ status      │
└─────────────┘

